<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotizador de Productos</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 0;
        }

        h1 {
            text-align: center;
        }

        .form-section {
            margin-bottom: 15px;
        }

        .form-section label {
            display: block;
            font-weight: bold;
        }

        .form-section input,
        .form-section textarea {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .form-section button {
            padding: 10px 15px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .form-section button:hover {
            background-color: #218838;
        }

        .hidden {
            display: none;
        }

        #vista-previa {
            max-width: 900px;
            margin: 0 auto;
        }

        .factura-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .factura-header h2 {
            margin: 0;
        }

        .factura-header p {
            margin: 5px 0;
            font-size: 14px;
        }

        .business-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        table, th, td {
            border: 1px solid #ccc;
            text-align: left;
        }

        th, td {
            padding: 8px;
        }

        th {
            background-color: #f2f2f2;
        }

        .total {
            font-size: 18px;
            font-weight: bold;
        }

        .total-container {
            text-align: right;
        }

        .comentarios {
            margin-top: 20px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>Cotizador de Productos</h1>

    <div id="formulario">
        <!-- Formulario para datos de la cotización -->
        <div class="form-section">
            <label for="nombre-cotizacion">Nombre de la Cotización</label>
            <input type="text" id="nombre-cotizacion" placeholder="Ej. Cotización Julio 2025">
        </div>

        <div class="form-section">
            <label for="cliente">Cliente</label>
            <input type="text" id="cliente" placeholder="Nombre del cliente">
        </div>

        <div class="form-section">
            <label for="rfc">RFC</label>
            <input type="text" id="rfc" placeholder="RFC del cliente">
        </div>

        <div class="form-section">
            <label for="telefono">Teléfono</label>
            <input type="text" id="telefono" placeholder="Teléfono del cliente">
        </div>

        <div class="form-section">
            <label for="email">Email</label>
            <input type="email" id="email" placeholder="Email del cliente">
        </div>

        <div class="form-section">
            <label for="producto">Producto</label>
            <input type="text" id="producto" placeholder="Nombre del producto">
        </div>

        <div class="form-section">
            <label for="cantidad">Cantidad</label>
            <input type="number" id="cantidad" value="1" min="1">
        </div>

        <div class="form-section">
            <label for="precio">Precio Unitario</label>
            <input type="number" id="precio" value="0" min="0">
        </div>

        <button onclick="agregarProducto()">Agregar Producto</button>

        <div class="form-section">
            <label for="comentarios">Comentarios</label>
            <textarea id="comentarios" placeholder="Comentarios adicionales"></textarea>
        </div>

        <button onclick="finalizarCotizacion()">Finalizar Cotización</button>
    </div>

    <div id="vista-previa" class="hidden">
        <div class="factura-header">
            <div class="business-name">La Bodeguita 1810</div>
            <h2>Cotización</h2>
            <p><strong>Nombre de la cotización:</strong> <span id="vista-nombre-cotizacion"></span></p>
            <p><strong>Cliente:</strong> <span id="vista-cliente"></span></p>
            <p><strong>RFC:</strong> <span id="vista-rfc"></span></p>
            <p><strong>Teléfono:</strong> <span id="vista-telefono"></span></p>
            <p><strong>Email:</strong> <span id="vista-email"></span></p>
        </div>

        <h3>Productos</h3>
        <table id="vista-productos">
            <thead>
                <tr>
                    <th>Producto</th>
                    <th>Cantidad</th>
                    <th>Precio Unitario</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <div class="total-container">
            <p class="total"><strong>Total:</strong> $<span id="total-sin-iva"></span></p>
        </div>

        <div class="comentarios">
            <p><strong>Comentarios:</strong> <span id="vista-comentarios"></span></p>
        </div>

        <button onclick="guardarCotizacion()">Guardar Cotización</button>
        <button onclick="exportarPDF()">Exportar a PDF</button>
        <button onclick="exportarJPG()">Exportar a JPG</button>
        <button onclick="resetFormulario()">Nuevo</button>
    </div>

    <script>
        let cotizacion = {
            nombre: '',
            cliente: '',
            rfc: '',
            telefono: '',
            email: '',
            productos: [],
            comentarios: '',
            totalSinIVA: 0
        };

        function agregarProducto() {
            const producto = document.getElementById("producto").value;
            const cantidad = parseFloat(document.getElementById("cantidad").value);
            const precio = parseFloat(document.getElementById("precio").value);

            if (producto && cantidad > 0 && precio >= 0) {
                const total = cantidad * precio;
                cotizacion.productos.push({ producto, cantidad, precio, total });

                // Limpiar campos del formulario
                document.getElementById("producto").value = '';
                document.getElementById("cantidad").value = 1;
                document.getElementById("precio").value = 0;

                // Actualizar la vista de productos
                actualizarVistaProductos();
            } else {
                alert("Por favor, ingresa datos válidos para el producto.");
            }
        }

        function actualizarVistaProductos() {
            const vistaProductos = document.getElementById("vista-productos").getElementsByTagName("tbody")[0];
            vistaProductos.innerHTML = '';
            cotizacion.productos.forEach((prod) => {
                const row = vistaProductos.insertRow();
                row.insertCell(0).textContent = prod.producto;
                row.insertCell(1).textContent = prod.cantidad;
                row.insertCell(2).textContent = `$${prod.precio.toFixed(2)}`;
                row.insertCell(3).textContent = `$${prod.total.toFixed(2)}`;
            });
            calcularTotales();
        }

        function calcularTotales() {
            const totalSinIVA = cotizacion.productos.reduce((acc, prod) => acc + prod.total, 0);
            cotizacion.totalSinIVA = totalSinIVA;
            document.getElementById("total-sin-iva").textContent = totalSinIVA.toFixed(2);
        }

        function finalizarCotizacion() {
            cotizacion.nombre = document.getElementById("nombre-cotizacion").value || 'Sin nombre';
            cotizacion.cliente = document.getElementById("cliente").value || 'No proporcionado';
            cotizacion.rfc = document.getElementById("rfc").value || 'No proporcionado';
            cotizacion.telefono = document.getElementById("telefono").value || 'No proporcionado';
            cotizacion.email = document.getElementById("email").value || 'No proporcionado';
            cotizacion.comentarios = document.getElementById("comentarios").value || 'No hay comentarios adicionales';

            // Actualizar la vista previa
            document.getElementById("vista-nombre-cotizacion").textContent = cotizacion.nombre;
            document.getElementById("vista-cliente").textContent = cotizacion.cliente;
            document.getElementById("vista-rfc").textContent = cotizacion.rfc;
            document.getElementById("vista-telefono").textContent = cotizacion.telefono;
            document.getElementById("vista-email").textContent = cotizacion.email;
            document.getElementById("vista-comentarios").textContent = cotizacion.comentarios;

            // Ocultar el formulario y mostrar la vista previa
            document.getElementById("formulario").classList.add("hidden");
            document.getElementById("vista-previa").classList.remove("hidden");

            // Actualizar productos
            actualizarVistaProductos();
        }

        function guardarCotizacion() {
            const cotizacionesGuardadas = JSON.parse(localStorage.getItem("cotizaciones")) || [];
            cotizacionesGuardadas.push(cotizacion);
            localStorage.setItem("cotizaciones", JSON.stringify(cotizacionesGuardadas));
            alert("Cotización guardada exitosamente.");
            resetFormulario();
        }

        function resetFormulario() {
            cotizacion = {
                nombre: '',
                cliente: '',
                rfc: '',
                telefono: '',
                email: '',
                productos: [],
                comentarios: '',
                totalSinIVA: 0
            };

            document.querySelectorAll("input, textarea").forEach(el => el.value = '');
            document.getElementById("formulario").classList.remove("hidden");
            document.getElementById("vista-previa").classList.add("hidden");
        }

        function exportarPDF() {
            const { jsPDF } = window.jspdf;

            html2canvas(document.getElementById("vista-previa")).then(canvas => {
                const imgData = canvas.toDataURL("image/png");
                const pdf = new jsPDF("p", "mm", "a4");

                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                const imgWidth = pageWidth;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;

                pdf.addImage(imgData, "PNG", 0, 0, imgWidth, imgHeight);
                const nombreArchivo = cotizacion.nombre.replace(/\s+/g, "_").toLowerCase() || "cotizacion";
                pdf.save(`${nombreArchivo}.pdf`);
            });
        }

        function exportarJPG() {
            html2canvas(document.getElementById("vista-previa")).then(canvas => {
                const link = document.createElement("a");
                link.download = `${cotizacion.nombre.replace(/\s+/g, "_").toLowerCase() || "cotizacion"}.jpg`;
                link.href = canvas.toDataURL("image/jpeg");
                link.click();
            });
        }
    </script>
</body>
</html>
